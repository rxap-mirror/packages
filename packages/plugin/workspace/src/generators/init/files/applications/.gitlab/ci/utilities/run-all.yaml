.run_all:
  stage: build
  image: node:${NODE_VERSION}-alpine
  variables:
    TARGET: "$CI_JOB_NAME"
  before_script:
    - *yarn
  script:
    - yarn nx run-many --target ${TARGET} --parallel $NX_PARALLEL ${ADDITIONAL_TARGET_OPTIONS}
  rules:
    - exists:
        - nx.json
      when: on_success
  artifacts:
    name: "${CI_COMMIT_REF_SLUG}_run-all_${TARGET}"
    paths:
      - dist
