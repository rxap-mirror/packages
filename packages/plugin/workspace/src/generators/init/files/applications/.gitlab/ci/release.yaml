include:
  - local: .gitlab/ci/jobs/build.yaml
  - local: .gitlab/ci/jobs/docker.yaml
  - local: .gitlab/ci/jobs/sentry.yaml

stages:
  - build
  - docker
  - sentry

variables:
  ENVIRONMENT_NAME: release/$CI_COMMIT_TAG
  DEPLOYMENT_TIER: production

build:
  extends: .build
  variables:
    ADDITIONAL_TARGET_OPTIONS: "--configuration production --channel $CI_ENVIRONMENT_SLUG --parallel $NX_PARALLEL --skip-nx-cache"
  environment:
    name: release/$CI_COMMIT_TAG
    deployment_tier: production

sentry:
  extends: .sentry
  environment:
    name: release/$CI_COMMIT_TAG
    deployment_tier: production
