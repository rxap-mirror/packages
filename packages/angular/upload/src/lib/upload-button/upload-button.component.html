<div class="flex flex-row gap-2 items-center">
  <button
    #button
    #method="rxapMethod"
    #trigger="cdkOverlayOrigin"
    (successful)="uploadComplete($event)"
    [disabled]="disabled"
    [parameters]="{ accept: accept, fileInput }"
    [rxapMethod]="fileUpload"
    cdkOverlayOrigin
    class="grow-0"
    mat-stroked-button
    type="button">
    <span class="flex flex-row justify-center items-center gap-3">
      <mat-icon class="grow-0" svgIcon="upload"></mat-icon>&nbsp;
      <span *ngIf="value" class="truncate grow-0">{{value.name}}</span>
      <ng-content></ng-content>
      <mat-progress-spinner
        *ngIf="method.executing$ | async"
        diameter="15"
        class="grow-0"
        mode="indeterminate">
      </mat-progress-spinner>
    </span>
  </button>
  <button (click)="openOverlay()"
          *ngIf="isImage"
          class="grow-0"
          i18n-matTooltip
          mat-icon-button
          matTooltip="Open image preview"
          type="button">
    <mat-icon>preview</mat-icon>
  </button>
  <button (click)="download()" *ngIf="allowDownload && value" class="grow-0" i18n-matTooltip mat-icon-button
          matTooltip="Download file" type="button">
    <mat-icon svgIcon="download"></mat-icon>
  </button>
</div>

<ng-template
  (backdropClick)="isOpen = false"
  [cdkConnectedOverlayHasBackdrop]="true"
  [cdkConnectedOverlayOpen]="isOpen"
  [cdkConnectedOverlayOrigin]="trigger"
  [cdkConnectedOverlayPositions]="positions"
  cdkConnectedOverlay
>
  <div class="bg-white dark:bg-black drop-shadow-xl overlay-container p-2 rounded overflow-auto">
    <img [src]="value | readAsDataURL | async" class="w-full">
  </div>
</ng-template>

<input #fileInput [accept]="accept" [id]="id" class="hidden" type="file">
