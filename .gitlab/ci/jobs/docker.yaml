.docker:
  image:
    name: gcr.io/kaniko-project/executor:debug
    entrypoint:
      - ""
  stage: docker
  tags:
    - e2-standard-2
  script: /bin/sh tools/scripts/build-and-push-docker-image.sh
  environment:
    action: prepare
  variables:
    GIT_LFS_SKIP_SMUDGE: "1"
  rules:
    - if: $DISABLE_DOCKER_BUILD
      when: never
    - when: on_success
  needs:
    - run
docker:angular:
  extends: .docker
  variables:
    DOCKER_CONTEXT: dist/demos/angular
    IMAGE_NAME: rxap/packages
    IMAGE_SUFFIX: /user-interface/angular
    DOCKERFILE: shared/angular/Dockerfile
  environment:
    name: $ENVIRONMENT_NAME
docker:service-configuration:
  extends: .docker
  variables:
    DOCKER_CONTEXT: dist/applications/service/configuration
    IMAGE_NAME: rxap/packages
    IMAGE_SUFFIX: /service/configuration
    DOCKERFILE: shared/nestjs/Dockerfile
  environment:
    name: $ENVIRONMENT_NAME
docker:service-status:
  extends: .docker
  variables:
    DOCKER_CONTEXT: dist/applications/service/status
    IMAGE_NAME: rxap/packages
    IMAGE_SUFFIX: /service/status
    DOCKERFILE: shared/nestjs/Dockerfile
  environment:
    name: $ENVIRONMENT_NAME
docker:service-user:
  extends: .docker
  variables:
    DOCKER_CONTEXT: dist/applications/service/user
    IMAGE_NAME: rxap/packages
    IMAGE_SUFFIX: /service/user
    DOCKERFILE: shared/nestjs/Dockerfile
  environment:
    name: $ENVIRONMENT_NAME
docker:service-app-angular-table:
  extends: .docker
  variables:
    DOCKER_CONTEXT: dist/demos/service/app/angular/table
    IMAGE_NAME: rxap/packages
    IMAGE_SUFFIX: /service/app-angular-table
    DOCKERFILE: shared/nestjs/Dockerfile
  environment:
    name: $ENVIRONMENT_NAME
