.docker:
  image:
    name: registry.gitlab.com/rxap/gitlab-ci/kaniko:latest
    entrypoint:
      - ""
  stage: docker
  tags:
    - e2-standard-2
  script: ./tools/scripts/build-and-push-docker-image.sh
  environment:
    action: prepare
    name: $ENVIRONMENT_NAME
  variables:
    GIT_LFS_SKIP_SMUDGE: "1"
  rules:
    - if: $DISABLE_DOCKER_BUILD
      when: never
    - when: on_success
  needs:
    - run
docker:angular:
  extends: .docker
  variables:
    IMAGE_NAME: rxap/packages
    PROJECT_NAME: angular
    DOCKER_CONTEXT: dist/demos/angular
    IMAGE_SUFFIX: /user-interface/angular
    DOCKERFILE: shared/angular/Dockerfile
docker:service-changelog:
  extends: .docker
  variables:
    IMAGE_NAME: rxap/packages
    PROJECT_NAME: service-changelog
    PATH_PREFIX: api/changelog
    DOCKER_CONTEXT: dist/applications/service/changelog
    IMAGE_SUFFIX: /service/changelog
    DOCKERFILE: shared/nestjs/Dockerfile
    NAME_PREFIX: rxap-
docker:service-configuration:
  extends: .docker
  variables:
    IMAGE_NAME: rxap/packages
    PROJECT_NAME: service-configuration
    PATH_PREFIX: api/configuration
    DOCKER_CONTEXT: dist/applications/service/configuration
    IMAGE_SUFFIX: /service/configuration
    DOCKERFILE: shared/nestjs/Dockerfile
    NAME_PREFIX: rxap-
docker:service-status:
  extends: .docker
  variables:
    IMAGE_NAME: rxap/packages
    PROJECT_NAME: service-status
    PATH_PREFIX: api/status
    DOCKER_CONTEXT: dist/applications/service/status
    IMAGE_SUFFIX: /service/status
    DOCKERFILE: shared/nestjs/Dockerfile
    NAME_PREFIX: rxap-
docker:service-user:
  extends: .docker
  variables:
    IMAGE_NAME: rxap/packages
    PROJECT_NAME: service-user
    PATH_PREFIX: api/user
    DOCKER_CONTEXT: dist/applications/service/user
    IMAGE_SUFFIX: /service/user
    DOCKERFILE: shared/nestjs/Dockerfile
    NAME_PREFIX: rxap-
docker:service-app-angular-table:
  extends: .docker
  variables:
    IMAGE_NAME: rxap/packages
    PROJECT_NAME: service-app-angular-table
    PATH_PREFIX: api/app/angular/table
    DOCKER_CONTEXT: dist/demos/service/app/angular/table
    IMAGE_SUFFIX: /service/app-angular-table
    DOCKERFILE: shared/nestjs/Dockerfile
