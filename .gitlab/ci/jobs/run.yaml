.run_rules: &run_rules
  rules:
    - when: on_success

run:
  extends: .run-many-dte
  stage: run
  tags:
    - e2-standard-2
  variables:
    TARGET: "build,lint,test"
  environment:
    action: prepare
    name: $ENVIRONMENT_NAME
  artifacts:
    name: "${CI_COMMIT_REF_SLUG}_run-many_${TARGET}"
    paths:
      - dist
  <<: *run_rules

agent:
  extends: .dte-agent
  allow_failure: true
  stage: run
  tags:
    - e2-standard-8
  environment:
    action: prepare
    name: $ENVIRONMENT_NAME
  parallel: 3
  <<: *run_rules
