.startup:
  image: curlimages/curl:8.3.0
  stage: startup
  needs:
    - job: docker
      artifacts: false
  tags:
    - e2-standard-2
  services:
    - name: ${SERVICE_REGISTRY_IMAGE}${IMAGE_SUFFIX}:${CI_PIPELINE_ID}
      alias: service
  environment:
    action: prepare
    name: $ENVIRONMENT_NAME
  variables:
    SERVICE_HOSTNAME: service
    SERVICE_REGISTRY_IMAGE: ${GCP_REGISTRY}/${GCP_PROJECT}/${IMAGE_NAME}
    ROOT_DOMAIN: $ROOT_DOMAIN
  script: curl --fail --location
    "http://${SERVICE_HOSTNAME}:${SERVICE_PORT}${SERVICE_PATH}"
  rules:
    - if: $DISABLE_STARTUP_TESTS
      when: never
    - when: on_success

startup:
  extends: .startup
  variables:
    IMAGE_NAME: m2v-frontends
  parallel:
    matrix:
      - SERVICE_PORT: "80"
        IMAGE_SUFFIX: /dashboard-editor
      - SERVICE_PORT: "80"
        IMAGE_SUFFIX: /i18n-editor
      - SERVICE_PORT: "80"
        IMAGE_SUFFIX: /mobile-dashboard
      - SERVICE_PORT: "80"
        IMAGE_SUFFIX: /portal
      - SERVICE_PORT: "80"
        IMAGE_SUFFIX: /remote-connection
      - SERVICE_PORT: "80"
        IMAGE_SUFFIX: /service-server
      - SERVICE_PORT: "80"
        IMAGE_SUFFIX: /settings
      - SERVICE_PORT: "80"
        IMAGE_SUFFIX: /ui-editor
      - SERVICE_PORT: "3000"
        SERVICE_PATH: /info
        IMAGE_SUFFIX: /service/enum
      - SERVICE_PORT: "3000"
        SERVICE_PATH: /info
        IMAGE_SUFFIX: /service/file-download
      - SERVICE_PORT: "3000"
        SERVICE_PATH: /info
        IMAGE_SUFFIX: /service/i18n
      - SERVICE_PORT: "3000"
        SERVICE_PATH: /info
        IMAGE_SUFFIX: /service/template
      - SERVICE_PORT: "3000"
        SERVICE_PATH: /info
        IMAGE_SUFFIX: /service/user-settings
      - SERVICE_PORT: "3000"
        SERVICE_PATH: /info
        IMAGE_SUFFIX: /service/feature/dashboard
      - SERVICE_PORT: "3000"
        SERVICE_PATH: /info
        IMAGE_SUFFIX: /service/feature/machine
      - SERVICE_PORT: "3000"
        SERVICE_PATH: /info
        IMAGE_SUFFIX: /service/feature/remote-connection
      - SERVICE_PORT: "3000"
        SERVICE_PATH: /info
        IMAGE_SUFFIX: /service/feature/report
      - SERVICE_PORT: "3000"
        SERVICE_PATH: /info
        IMAGE_SUFFIX: /service/app/mobile-dashboard/machine
      - SERVICE_PORT: "3000"
        SERVICE_PATH: /info
        IMAGE_SUFFIX: /service/app/mobile-dashboard/overview
      - SERVICE_PORT: "3000"
        SERVICE_PATH: /info
        IMAGE_SUFFIX: /service/app/portal/overview
      - SERVICE_PORT: "3000"
        SERVICE_PATH: /info
        IMAGE_SUFFIX: /service/app/service-server/service-network
      - SERVICE_PORT: "3000"
        SERVICE_PATH: /info
        IMAGE_SUFFIX: /service/app/settings/dashboard-template
      - SERVICE_PORT: "3000"
        SERVICE_PATH: /info
        IMAGE_SUFFIX: /service/app/settings/machine
      - SERVICE_PORT: "3000"
        SERVICE_PATH: /info
        IMAGE_SUFFIX: /service/app/settings/machine-definition
      - SERVICE_PORT: "3000"
        SERVICE_PATH: /info
        IMAGE_SUFFIX: /service/app/settings/report
